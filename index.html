<!DOCTYPE html>
<html>
  <head>
    <title>EmoMDS</title>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugin-survey-text.js"></script>
    <script src="jspsych/plugin-preload.js"></script>
    <script src="jspsych/plugin-html-keyboard-response.js"></script>
    <script src="jspsych/plugin-html-button-response.js"></script>
    <script src="jspsych/plugin-html-slider-response.js"></script>
    <script src="jspsych/plugin-audio-keyboard-response.js"></script>
    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />
    <style>
        .jspsych-display-element {
            font-size: 24px;
        }
    </style>
</head>
  <body></body>
  <script>
    var jsPsych = initJsPsych({
        on_finish: function() {
            jsPsych.data.get().localSave('csv','mydata.csv');
        },
        show_progress_bar: true
    });

    var timeline = [];

    var preload = {
    type: jsPsychPreload,
    auto_preload: true
    }

    var idInputTrial = {
            type: jsPsychSurveyText,
            questions: [
                {prompt: 'Participant ID:', placeholder: '099', required: true},
            ],
            on_finish: function(data) {
                
            }
    };
    timeline.push(idInputTrial);

    var welcome = {
        type: jsPsychHtmlButtonResponse,
            stimulus: `
            <p>Welcome to the experiment.</p>
            <p>In this study, we are interested to understand how you perceive emotions you hear in singing.</p>
            `,
            choices:['Continue to instructions'],
    };
    timeline.push(welcome);

    var instructions1 = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
        <p>You will listen to pairs of excerpts.</p>
        <p>Rate how different you think the two excerpts are in terms of their affective content.</p>
        <p>If you think that the two excerpts are very <strong>similar</strong> emotionally, move the slider all the way to the left at "1"</p>
        <p>If you think that the two excerpts are very <strong>different</strong> emotionally, move the slider all the way to the right at "8"</p>
        <p>There are no right or wrong answers. We are interested in how <strong>you</strong> perceive the emotions in the excerpts.</p>
        `,
        choices:['Next'],
    };
    timeline.push(instructions1);

    var instructions2 = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
        <p>First, you are going to listen to all the different excerpts that will be presented in this experiment</p>
        <p>to have an idea of the range of emotions you will hear.</p>
        <p>The excerpts will play automatically, one after the other.</p>
        <p>You will hear each excerpt only once.</p>
        `,
        choices:['Begin playing'],
    };
    timeline.push(instructions2);

    var allaudioStim = ['sound/Angry1.mp3','sound/Happy2.mp3'];
    
    function shuffle(array) {
        var currentIndex = array.length, temporaryValue, randomIndex;
        
        while (0 !== currentIndex) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex -= 1;

            temporaryValue = array[currentIndex];
            array[currentIndex] = array[randomIndex];
            array[randomIndex] = temporaryValue;
    }
    return array;
    }
    
    allaudioStim = shuffle(allaudioStim);

    allaudioStim.forEach(function(allaud) {
        var allaudio = {
            type: jsPsychAudioKeyboardResponse,
            stimulus: allaud,
            choices: "NO_KEYS",
            trial_ends_after_audio: true
        }
        var delay = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: '',
        trial_duration: 1000,
        response_ends_trial: false
        }
        timeline.push(allaudio, delay);
    });

    var start = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
            <p>Now you are ready to start the experiment.</p>
            <p>Click \"Next\" to proceed<p>
            `,
        choices:['Next'],
    };
    timeline.push(start);
    
    var audioStimuli = ['sound/Angry1.mp3','sound/Happy2.mp3',
                        'sound/Calm2.mp3','sound/Sad1.mp3'];

                        function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex;

    while (0 !== currentIndex) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;

        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    }
    return array;
    }
    
    audioStimuli = shuffle(audioStimuli);

    for (var i = 0; i < audioStimuli.length; i += 2) {
        var audio1 = {
            type: jsPsychAudioKeyboardResponse,
            stimulus: audioStimuli[i],
            choices: "NO_KEYS",
            trial_ends_after_audio: true
        };

        var delay1 = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: '',
        trial_duration: 1000,
        response_ends_trial: false
        }
            
        var audio2 = {
            type: jsPsychAudioKeyboardResponse,
            stimulus: audioStimuli[i+1],
            choices: "NO_KEYS",
            trial_ends_after_audio: true
        };

        var slider = {
            type: jsPsychHtmlSliderResponse,
            stimulus: '<p>How similar do you think these two emotions are?</p>',
            labels: ['Very similar (1)', '2', '3', '4', '5', '6', '7','Very different (8)'],
            step: 0.01,
            prompt: '<p></p>',
            slider_width: 1000,
            require_movement: true,
            button_label: 'Next'
        }
        timeline.push(audio1, delay1, audio2, slider)
    };
    
    // select all trials
    var all_data = jsPsych.data.get();

    // get csv representation of data and log to console
    console.log(all_data.csv());

    jsPsych.run(timeline);

  </script>
</html>